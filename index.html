<!doctype html>
<!--
    disk.dog is a big file transfer service
    Copyright (C) 2021 DomeQdev
    Copyright (C) 2021 AKurushimi

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<html ondragover="onDragEnter(event)" ondrop="onDrop(event)" ondragend="onDragEnd(event)">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>disk.dog</title>
    <meta name="description" content="Big file transfer service for free." />
    <link rel="icon" type="image/png" href="./src/images/logo.png" />

    <link href="src/css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.slim.min.js"></script>
</head>

<body class="bg-gray-900 flex h-screen text-gray-200">
    <!-- top stuff -->
    <div class="z-30">
        <img class="absolute w-auto h-20 ml-4 " src="./src/images/logo.png" alt="logo">
        <button id="settings_modal_show_button" class="absolute inset-y-0 right-3 p-4 max-h-16"><i class="fas fa-cog"></i></button>
    </div>
    <!-- top stuff -->

    <!--center stuff-->
    <div class="m-auto text-center rounded-lg z-30">
        <div class="bg-gray-800 p-3 m-auto rounded-lg">
            <div id="main" class="">
                <input type="file" id="uploader" class="hidden">
                <button onclick="$('#uploader').click();" class="bg-gray-800 hover:bg-gray-900 border-gray-900 border-2 w-96 h-72 text-center rounded-lg">click here to upload</button>
            </div>
            <div class="mt-3 text-center hidden" id="upload_screen">
                <!-- <h3 class="text-lg leading-6 font-medium text-gray-200">upload file</h3> -->
                <div class="mt-2 px-3 py-3 grid grid-cols-2 grid-rows-none divide-x-2 divide-gray-400" id="upload_div">
                    <div>
                        <p class="text-9xl"><i id="file_icon" class="fa-solid"></i></p>
                        <p class="dz-filename" id="file_name"></p>
                        <p class="dz-size" id="file_size"></p>
                    </div>
                    <div id="input_div">
                        <p class="px-2 py-2">password:</p>
                        <input type="password" placeholder="*optional*" id="password_field" class="bg-gray-900 text-center rounded-lg input_thing w-44">
                        <!-- <button id="show_password" class="p-3 rounded-lg active:bg-gray-900 hover:bg-gray-500"><i id="show_password_text" class="fas fa-eye"></i></button> -->
                        <p class="px-2 py-2">duration:</p>
                        <select id="duration_selector" class="bg-gray-900 text-center rounded-lg input_thing w-44"></select>
                        <p class="px-2 py-2">region:</p>
                        <select id="region_selector" class="bg-gray-900 text-center rounded-lg input_thing w-44">
                            <option value="au">Australia</option>
                            <option value="eu">Europe</option>
                            <option value="us">USA</option>
                        </select>
                        <button id="upload_button" class="px-4 py-2 bg-gray-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:border-2 hover:border-gray-900 hover:bg-gray-500 focus:bg-gray-900 focus:outline-none">
                            Upload
                        </button>
                        <button>Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- center stuff -->

        <!-- footer -->
        <div class="text-center bottom-3 inset-x-0 absolute z-40">
            <a href="/terms" class="text-blue-200">Terms of Service</a> | <a href="/privacy" class="text-blue-200">Privacy Policy</a> | <a href="/about" class="text-blue-200">About</a>
        </div>
        <!-- footer -->
        <script>
            let settings_things = document.getElementById("input_div").querySelectorAll(".input_thing");

            if (localStorage.getItem('password'))
                settings_things[0].value = localStorage.getItem('password');
            if (localStorage.getItem('duration'))
                settings_things[1].value = localStorage.getItem('duration');
            if (localStorage.getItem('region'))
                settings_things[2].value = localStorage.getItem('region');

            $("#show_password").mousedown(function () {
                $(this).prev().prop('type', 'text');
                $("#show_password_text").removeClass("fa-eye").addClass("fa-eye-slash");
            }).mouseup(function () {
                $(this).prev().prop('type', 'password');
                $("#show_password_text").removeClass("fa-eye-slash").addClass("fa-eye");
            }).mouseout(function () {
                $(this).prev().prop('type', 'password');
                $("#show_password_text").removeClass("fa-eye-slash").addClass("fa-eye");
            });
            let allowed = [];
            function confirmation_prompt() {
                let _file = $("#uploader").get(0).files[0];

                $("#upload_screen").removeClass("hidden");
                $("#main").addClass("hidden");
                
                let file_size = _file.size;
                if (file_size < 1000) file_size = `${file_size}B`;
                else if (file_size < 1000000) file_size = `${Number(file_size / 1000).toFixed(2)}KB`;
                else if (file_size < 1000000000) file_size = `${Number(file_size / 1000000).toFixed(2)}MB`;
                else file_size = `${Number(file_size / 1000000000).toFixed(2)}GB`;
                $("#file_size").text(file_size);

                if(_file.size < 1_000_000_000) allowed = ["3600", "7200", "21600", "43200", "86400", "172800"];
                else if(_file.size < 5_000_000_000) allowed = ["3600", "7200", "21600", "43200", "86400"];
                else if(_file.size < 10_000_000_000) allowed = ["3600", "7200", "21600", "43200"];
                else if(_file.size < 20_000_000_000) allowed = [ "3600", "7200", "21600"];
                else if(_file.size < 50_000_000_000) allowed = [ "3600", "7200"];
                else allowed = [ "3600"];

                $("#duration_selector").html(`
                    <option value="3600" ${allowed.includes("3600") ? "" : "disabled"}>1 hour</option>
                    <option value="7200" ${allowed.includes("7200") ? "" : "disabled"}>2 hours</option>
                    <option value="21600" ${allowed.includes("21600") ? "" : "disabled"}>6 hours</option>
                    <option value="43200" ${allowed.includes("43200") ? "" : "disabled"}>12 hours</option>
                    <option value="86400" ${allowed.includes("86400") ? "" : "disabled"}>1 day</option>
                    <option value="172800" ${allowed.includes("172800") ? "" : "disabled"}>2 days</option>
                `);

                $("#file_icon").removeClass().addClass("fa-solid");
                $("#file_name").text(_file.name);
                let file_extension = _file.name.split(".")
                file_extension = file_extension[file_extension.length - 1]
                let file_type = _file.type
                if (file_type.includes("image")) $("#file_icon").addClass("fa-file-image");
                else if (file_type.includes("audio")) $("#file_icon").addClass("fa-file-audio");
                else if (file_type.includes("video")) $("#file_icon").addClass("fa-file-video");
                else if (file_type.includes("text")) $("#file_icon").addClass("fa-file-lines");
                else $("#file_icon").addClass("fa-file");
            };

            $("#uploader").change(() => confirmation_prompt());

            $("#upload_button").focus(() => {
                $("#uploader").val([]);
                $("#upload_screen").addClass("hidden");
                $("#main").removeClass("hidden");
            });

            function onDrop(event) {
                event.preventDefault();
                let files = event.dataTransfer.files;
                $("#uploader").get(0).files = files;
                confirmation_prompt();
            }

            function onDragEnter(event) {
                event.preventDefault();
                event.stopPropagation();
            }

            function onDragEnd(event) {
                event.preventDefault();
                event.stopPropagation();
            }
        </script>
</body>

</html>