<!DOCTYPE html>
<html lang="en" ondragenter="onDragEnter(event)" ondragover="onDragEnter(event)" ondrop="onDrop(event)" ondragend="onDragEnd(event)" ondragleave="onDragEnd(event);">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>disk.dog</title>
    <meta name="description" content="Big file transfer service for free." />
    <link rel="icon" type="image/png" href="/assets/logo.png" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.slim.min.js"></script>
    <link rel="stylesheet" href="/assets/style.css">
    <style>
        #wallpaper-frame {
            background: transparent;
            border: 0;
            transition: transform .5s cubic-bezier(.77,0,.175,1);
            height: 100%;
            left: 0;
    position: absolute;
    top: 0;
    width: 100%;
    -webkit-tap-highlight-color: transparent;
    box-sizing: border-box;
        }
    </style>
</head>

<body class="bg-gray-900 flex h-screen text-gray-200">
    <iframe allow="autoplay; camera" class="z-0 hidden md:block" frameborder="0" scrolling="no" src="https://dq.ct8.pl/ad.html" title="wallpaper-frame" id="wallpaper-frame"></iframe>
    <header class="hidden sm:block z-10">
        <ul class="lightrope">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
          </ul>
        <a href="/"><img class="absolute w-auto h-20 ml-4 " src="/assets/logo.png" alt="logo"></a>
        <a class="absolute inset-y-0 right-3 p-4 max-h-16" href="https://discord.gg/DmSvkjMhqv" title="Join Discord"><i class="fa-brands fa-discord text-2xl"></i></a>
    </header>

    <input type="file" id="upload_files" class="hidden" multiple>
    <input type="file" id="upload_folder" class="hidden" webkitdirectory mozdirectory>

    <main id="main" class="left-30 bg-gray-800 p-3 m-auto rounded-lg top-1/2 left-1/2 absolute z-20" style="transform: translate(-50%, -50%);box-shadow: 0 0 12px 0 rgba(0,0,0,.1),0 10px 30px 0 rgba(0,0,0,.2);">
        <div class="sm:hidden text-center" onclick="window.location.href=`https://m.disk.dog`;">
            <i class="fa-regular fa-circle-xmark text-4xl text-red-600"></i>
            <p class="invisible w-72 h-4"></p>    
            <p class="text-md">Sorry, your device can't use this version.</p>
            <p class="text-sm">Please use <a href="https://m.disk.dog" class="text-blue-200">mobile version</a>.</p>
        </div>
        <div id="first" class="sm:block hidden">
            <button onclick="document.getElementById('uploader').click();"
                class="bg-gray-800 hover:bg-gray-900 border-gray-900 border-2 w-96 h-72 text-center rounded-lg">
                <i class="fa-solid fa-upload text-4xl"></i>
                <p>Drop files here or click to upload.</p>
            </button>
        </div>
    </main>

    <footer class="mt-auto pb-4 text-center justify-center w-screen hidden sm:block z-10">
        <a href="/terms" class="text-blue-200">Terms of Service</a> | <a href="/privacy" class="text-blue-200">Privacy Policy</a> | <a href="https://github.com/disk-dog" class="text-blue-200">GitHub</a>
    </footer>
    <script src="/assets/api.js"></script>
    <script>
        function confirmation_prompt() {
            let _file = $("#uploader").get(0).files[0];

            $("#upload_screen").removeClass("hidden");
            $("#main").addClass("hidden");

            let file_size = _file.size;
            if (file_size < 1000) file_size = `${file_size}B`;
            else if (file_size < 1000000) file_size = `${Number(file_size / 1000).toFixed(2)}KB`;
            else if (file_size < 1000000000) file_size = `${Number(file_size / 1000000).toFixed(2)}MB`;
            else file_size = `${Number(file_size / 1000000000).toFixed(2)}GB`;
            $("#file_size").text(file_size);

            let allowed = [];
            if (_file.size < 1_000_000_000) allowed = ["3600", "7200", "21600", "43200", "86400", "172800"];
            else if (_file.size < 5_000_000_000) allowed = ["3600", "7200", "21600", "43200", "86400"];
            else if (_file.size < 10_000_000_000) allowed = ["3600", "7200", "21600", "43200"];
            else if (_file.size < 20_000_000_000) allowed = ["3600", "7200", "21600"];
            else if (_file.size < 50_000_000_000) allowed = ["3600", "7200"];
            else allowed = ["3600"];

            $("#duration_selector").html(`
                <option value="172800" ${allowed.includes("172800") ? "" : "disabled"}>2 days</option>
                <option value="86400" ${allowed.includes("86400") ? "" : "disabled"}>1 day</option>
                <option value="43200" ${allowed.includes("43200") ? "" : "disabled"}>12 hours</option>
                <option value="21600" ${allowed.includes("21600") ? "" : "disabled"}>6 hours</option>
                <option value="7200" ${allowed.includes("7200") ? "" : "disabled"}>2 hours</option>
                <option value="3600" ${allowed.includes("3600") ? "" : "disabled"}>1 hour</option>
            `);

            $("#file_icon").removeClass().addClass("fa-solid");
            $("#file_name").text(_file.name);
            let file_extension = _file.name.split(".")
            file_extension = file_extension[file_extension.length - 1]
            let file_type = _file.type
            if (file_type.includes("image")) $("#file_icon").addClass("fa-file-image");
            else if (file_type.includes("audio")) $("#file_icon").addClass("fa-file-audio");
            else if (file_type.includes("video")) $("#file_icon").addClass("fa-file-video");
            else if (file_type.includes("text")) $("#file_icon").addClass("fa-file-lines");
            else $("#file_icon").addClass("fa-file");
        };

        $("#uploader").change(() => confirmation_prompt());

        $("#upload_button").focus(() => {
            let file = $("#uploader").get(0).files[0];
            handleUpload(file);
        })

        $("#cancel_button").focus(() => {
            $("#uploader").val([]);
            $("#upload_screen").addClass("hidden");
            $("#main").removeClass("hidden");
        });

        function onDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            if(!event.dataTransfer.files) return;
            $("#drag").addClass("hidden");
            $("#main").removeClass("hidden");
            let files = event.dataTransfer.files;
            $("#upload_files").get(0).files = files;
            confirmation_prompt();
        }

        function onDragEnter(event) {
            event.preventDefault();
            event.stopPropagation();
            if(!event.dataTransfer.files) return;
            $("#main").addClass("hidden");
            $("#drag").removeClass("hidden");
        }

        function onDragEnd(event) {
            event.preventDefault();
            event.stopPropagation();
            if(!event.dataTransfer.files) return;
            $("#drag").addClass("hidden");
            $("#main").removeClass("hidden");
        }
    </script>
</body>
</html>